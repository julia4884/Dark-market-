<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | Dark Market Ultra</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #flying-bat {
      position: fixed;
      top: 50px;
      left: 50px;
      font-size: 2rem;
      cursor: pointer;
      transition: all 1s ease;
      z-index: 1000;
    }
    #bat-message {
      position: fixed;
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 0.9rem;
      display: none;
      z-index: 1001;
    }
    #cat-widget {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 2.5rem;
      cursor: pointer;
      z-index: 1000;
    }
    #contact-form-container {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: #1a1a1a;
      color: white;
      padding: 15px;
      border: 1px solid #444;
      border-radius: 10px;
      z-index: 1001;
    }
    #contact-form input,
    #contact-form textarea {
      width: 100%;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <h1 class="site-title">‚òæ Dark Market Ultra ‚ú¶</h1>
    <nav>
      <a href="home.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="index.html" id="logout-btn">–í—ã—Ö–æ–¥</a>
    </nav>
  </header>

  <main>
    <section id="cabinet-panel">
      <h2 id="cabinet-title">–í–∞—à –∫–∞–±–∏–Ω–µ—Ç</h2>
      <div id="profile-info"></div>

      <!-- –†–∞–∑–¥–µ–ª —Ñ–∞–π–ª–æ–≤ -->
      <h3>–í–∞—à–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</h3>
      <ul id="file-list"></ul>
    </section>
  </main>

  <!-- –õ–µ—Ç—É—á–∞—è –º—ã—à—å -->
  <div id="flying-bat">ü¶á</div>
  <div id="bat-message"></div>

  <!-- –ö–æ—à–∫–∞ -->
  <div id="cat-widget">üêà‚Äç‚¨õ</div>
  <div id="contact-form-container" style="display:none;">
    <form id="contact-form">
      <h3>–ù–∞–ø–∏—à–∏ –∞–¥–º–∏–Ω—É</h3>
      <input type="email" id="contact-email" placeholder="–í–∞—à Email" required>
      <textarea id="contact-message" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." required></textarea>
      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button type="button" id="close-contact">–ó–∞–∫—Ä—ã—Ç—å</button>
    </form>
  </div>

  <script src="script.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    const token = localStorage.getItem("token");
    if (!token) {
      alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç!");
      window.location.href = "index.html";
      return;
    }

    try {
      const res = await fetch("/profile", {
        headers: { Authorization: `Bearer ${token}` },
      });
      const user = await res.json();
      if (!user || user.error) {
        alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è");
        return;
      }

      document.getElementById("profile-info").innerHTML = `
        <div>
          <img src="${user.avatar}" alt="avatar" class="avatar">
          <p><strong>${user.username}</strong></p>
          <p>${user.about || "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è"}</p>
        </div>
      `;

      loadFiles();
    } catch {
      alert("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
    }

    // === –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ ===
    async function loadFiles() {
      try {
        const res = await fetch("/list-files", {
          headers: { Authorization: `Bearer ${token}` },
        });
        const files = await res.json();
        const list = document.getElementById("file-list");
        if (files.length === 0) {
          list.innerHTML = "<li>–§–∞–π–ª–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</li>";
        } else {
          list.innerHTML = files
            .map(f => `<li><a href="${f.url}" target="_blank">${f.name}</a></li>`)
            .join("");
        }
      } catch {
        console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤");
      }
    }

    // === –õ–µ—Ç—É—á–∞—è –º—ã—à—å ü¶á ===
    const bat = document.getElementById("flying-bat");
    const batMessage = document.getElementById("bat-message");
    const batMessages = [
      "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç—ë–º–Ω—ã–π –º–∏—Ä!",
      "–Ø —Ç—É—Ç –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ª–µ—Ç–∞—é ü¶á",
      "–û—Å—Ç–æ—Ä–æ–∂–Ω–æ... —è –Ω–∞–±–ª—é–¥–∞—é –∑–∞ —Ç–æ–±–æ–π üëÄ",
      "–¢—ã —Å–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω–æ –≤—ã–≥–ª—è–¥–∏—à—å!",
      "–ù–µ –∑–∞–±—É–¥—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã!",
      "–ü—Å—Å... —Ç–∞–º —Å–∫–∏–¥–∫–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ!",
      "–ï—Å–ª–∏ –±–æ–∏—à—å—Å—è ‚Äî –∂–º–∏ –Ω–∞ –∫–æ—à–∫—É üêà‚Äç‚¨õ",
    ];

    function moveBat() {
      if (!bat) return;
      const x = Math.random() * (window.innerWidth - 80);
      const y = Math.random() * (window.innerHeight - 80);
      bat.style.left = `${x}px`;
      bat.style.top = `${y}px`;
    }
    setInterval(moveBat, 4000);

    bat.addEventListener("click", () => {
      const msg = batMessages[Math.floor(Math.random() * batMessages.length)];
      batMessage.textContent = msg;
      batMessage.style.left = bat.style.left;
      batMessage.style.top = `calc(${bat.style.top} - 40px)`;
      batMessage.style.display = "block";
      setTimeout(() => (batMessage.style.display = "none"), 2500);
    });

    // === –ö–æ—à–∫–∞ üêà‚Äç‚¨õ ===
    const catWidget = document.getElementById("cat-widget");
    const contactFormContainer = document.getElementById("contact-form-container");
    const contactForm = document.getElementById("contact-form");
    const closeContact = document.getElementById("close-contact");

    catWidget.addEventListener("click", () => {
      contactFormContainer.style.display =
        contactFormContainer.style.display === "block" ? "none" : "block";
    });

    closeContact.addEventListener("click", () => {
      contactFormContainer.style.display = "none";
    });

    contactForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("contact-email").value.trim();
      const message = document.getElementById("contact-message").value.trim();
      if (!email || !message) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");

      try {
        const res = await fetch("/contact", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, message }),
        });
        const data = await res.json();
        alert(data.success ? "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!" : "–û—à–∏–±–∫–∞: " + data.error);
        if (data.success) contactFormContainer.style.display = "none";
      } catch {
        alert("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
      }
    });
  });
  </script>
  <script src="script.js"></script>
<script src="cabinet.js"></script>
</body>
</html>
