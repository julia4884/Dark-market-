<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Личный кабинет — Dark Market Ultra</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: #0a0a0a;
      color: #e0e0e0;
      font-family: Arial, sans-serif;
    }
    nav {
      margin-bottom: 20px;
    }
    nav a {
      margin-right: 15px;
      color: #fff;
      text-decoration: none;
    }
    .tab-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    .tab-button {
      background: #1c1c1c;
      color: #e0e0e0;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
    }
    .tab-button.active {
      background: #444;
      border-bottom: 2px solid crimson;
    }
    .tab-content {
      display: none;
      padding: 20px;
      background: #1c1c1c;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
    }
    .tab-content.active {
      display: block;
    }
    .profile-pic {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 10px;
      border: 2px solid crimson;
    }
    input, textarea {
      display: block;
      margin-top: 10px;
      margin-bottom: 15px;
      padding: 10px;
      width: 100%;
      background: #222;
      color: #fff;
      border: 1px solid #444;
    }
    button {
      background: crimson;
      color: #fff;
      padding: 10px 15px;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: darkred;
    }
    .progress-bar {
      width: 100%;
      background: #333;
      border-radius: 5px;
      overflow: hidden;
      margin-top: 10px;
      display: none;
    }
    .progress-bar-inner {
      height: 15px;
      background: crimson;
      width: 0%;
    }
    .status {
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Главная</a>
    <a href="games.html">Игры</a>
    <a href="movies.html">Фильмы</a>
    <a href="music.html">Музыка</a>
    <a href="images.html">Картинки</a>
    <a href="books.html">Книги</a>
    <a href="apps.html">Программы</a>
    <a href="tools.html">Приложения</a>
  </nav>

  <h1>Личный кабинет</h1>

  <div class="tab-container">
    <button class="tab-button active" onclick="openTab('profile')">Профиль</button>
    <button class="tab-button" onclick="openTab('purchases')">Мои покупки</button>
    <button class="tab-button" onclick="openTab('uploads')">Мои загрузки</button>
    <button class="tab-button" onclick="openTab('admin')">Админка</button>
  </div>

  <!-- Профиль -->
  <div id="profile" class="tab-content active">
    <h2>Профиль</h2>
    <img id="profilePic" src="default-avatar.png" alt="Фото профиля" class="profile-pic">
    <form id="profileForm">
      <label for="avatar">Загрузить новое фото:</label>
      <input type="file" id="avatar" name="avatar" accept="image/*">
      <label for="nickname">Никнейм:</label>
      <input type="text" id="nickname" placeholder="Введите ник">
      <label for="about">О себе:</label>
      <textarea id="about" rows="4" placeholder="Расскажите о себе..."></textarea>
      <button type="submit">Сохранить изменения</button>
    </form>
    <p id="status">Статус: <strong>Пользователь</strong></p>
  </div>

  <!-- Покупки -->
  <div id="purchases" class="tab-content">
    <h2>Мои покупки</h2>
    <ul id="purchaseList">
      <li>Пока ничего не куплено</li>
    </ul>
  </div>

  <!-- Загрузки -->
  <div id="uploads" class="tab-content">
    <h2>Мои загрузки</h2>
    <form id="uploadForm">
      <label for="file">Загрузить файл:</label>
      <input type="file" id="file" name="file">
      <label for="price">Цена (€):</label>
      <input type="number" id="price" name="price" min="0" step="0.01">
      <button type="submit">Загрузить</button>
    </form>
    <div class="progress-bar" id="progressBar">
      <div class="progress-bar-inner" id="progressBarInner"></div>
    </div>
    <div class="status" id="uploadStatus"></div>
    <ul id="myUploads">
      <li>Пока нет загруженных файлов</li>
    </ul>
  </div>

  <!-- Админка -->
  <div id="admin" class="tab-content">
    <h2>Админка</h2>
    <form id="blockUserForm">
      <label for="blockUser">Заблокировать пользователя:</label>
      <input type="text" id="blockUser" placeholder="Введите email">
      <button type="submit">Заблокировать</button>
    </form>
    <form id="blockAppForm">
      <label for="blockApp">Заблокировать приложение:</label>
      <input type="text" id="blockApp" placeholder="Введите ID приложения">
      <button type="submit">Заблокировать</button>
    </form>
  </div>

  <script>
    const backendUrl = "https://dark-market-backend.onrender.com";

    function openTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }

    // Загрузка аватара
    document.getElementById('profileForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = document.getElementById('avatar').files[0];
      if (!file) return alert("Выберите фото!");
      const formData = new FormData();
      formData.append('avatar', file);

      try {
        const res = await fetch(`${backendUrl}/upload-photo`, {
          method: 'POST',
          body: formData
        });
        const result = await res.json();
        if (result.url) {
          document.getElementById('profilePic').src = result.url;
          alert("Фото профиля обновлено!");
        } else {
          alert("Ошибка при загрузке фото");
        }
      } catch (err) {
        alert("Ошибка сервера: " + err.message);
      }
    });

    // Загрузка файлов с прогресс-баром
    document.getElementById('uploadForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const file = document.getElementById('file').files[0];
      const price = document.getElementById('price').value;
      if (!file) return alert("Выберите файл!");
      
      const formData = new FormData();
      formData.append('file', file);
      formData.append('price', price);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", `${backendUrl}/upload-file`, true);

      xhr.upload.onprogress = function(e) {
        if (e.lengthComputable) {
          const percent = Math.round((e.loaded / e.total) * 100);
          document.getElementById('progressBar').style.display = 'block';
          document.getElementById('progressBarInner').style.width = percent + '%';
          document.getElementById('uploadStatus').innerText = `Загрузка: ${percent}%`;
        }
      };

      xhr.onload = function() {
        if (xhr.status === 200) {
          document.getElementById('uploadStatus').innerText = "Файл успешно загружен!";
        } else {
          document.getElementById('uploadStatus').innerText = "Ошибка при загрузке.";
        }
      };

      xhr.send(formData);
    });
  </script>
</body>
</html>
