<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Äî Dark Market Ultra</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #111;
            color: #eee;
            text-align: center;
            padding: 20px;
        }
        header, footer {
            margin-bottom: 20px;
        }
        #profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
        section {
            background: #1c1c1c;
            padding: 20px;
            margin: 20px auto;
            border-radius: 10px;
            max-width: 500px;
        }
        button {
            background: crimson;
            border: none;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 6px;
        }
        button:hover {
            background: darkred;
        }
        textarea {
            width: 90%;
            height: 80px;
            resize: none;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Dark Market Ultra</h1>
        <h3>–¢—ë–º–Ω—ã–π —É–≥–æ–ª–æ–∫ —Å–≤–æ–±–æ–¥—ã</h3>
    </header>

    <main>
        <section id="user-info">
            <img id="profile-photo" src="default-avatar.png" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è">
            <h2 id="welcomeMessage">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
            <p><b>–ù–∏–∫–Ω–µ–π–º:</b> <span id="nickname">...</span></p>
            <p><b>–°—Ç–∞—Ç—É—Å:</b> <span id="status">...</span></p>
            <p><b>–ü–æ–¥–ø–∏—Å–∫–∞:</b> <span id="subscription">...</span></p>
            <input type="file" id="photoUpload" accept="image/*">
            <button id="savePhotoBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
            <hr>
            <h3>–û —Å–µ–±–µ</h3>
            <textarea id="aboutMe" placeholder="–ù–∞–ø–∏—à–∏ –æ —Å–µ–±–µ..."></textarea><br>
            <button id="saveAboutBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <hr>
            <button id="logoutBtn">üö™ –í—ã–π—Ç–∏</button>
        </section>
    </main>

    <footer>
        <p>¬© Dark Market Ultra ¬© 2025. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
    </footer>

    <script src="config.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("token");
        if (!token) {
            alert("–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!");
            window.location.href = "index.html";
            return;
        }

        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            const res = await fetch(`${API_URL}/profile`, {
                headers: { Authorization: "Bearer " + token }
            });
            const data = await res.json();

            if (!data.success) {
                alert("–û—à–∏–±–∫–∞: " + data.error);
                window.location.href = "index.html";
                return;
            }

            document.getElementById("welcomeMessage").innerText = `–ü—Ä–∏–≤–µ—Ç, ${data.username} üëã`;
            document.getElementById("nickname").innerText = data.username;
            document.getElementById("status").innerText = data.role;
            document.getElementById("subscription").innerText = data.subscription;
            if (data.photo) document.getElementById("profile-photo").src = API_URL + data.photo;
            document.getElementById("aboutMe").value = data.about || "";

        } catch (err) {
            console.error(err);
            window.location.href = "index.html";
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ "–û —Å–µ–±–µ"
        document.getElementById("saveAboutBtn").addEventListener("click", async () => {
            const about = document.getElementById("aboutMe").value;
            try {
                const res = await fetch(`${API_URL}/profile/update`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: "Bearer " + token,
                    },
                    body: JSON.stringify({ about }),
                });
                const result = await res.json();
                if (result.success) {
                    alert("–û–ø–∏—Å–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!");
                } else {
                    alert("–û—à–∏–±–∫–∞: " + result.error);
                }
            } catch (err) {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è.");
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
        document.getElementById("savePhotoBtn").addEventListener("click", async () => {
            const fileInput = document.getElementById("photoUpload");
            if (!fileInput.files[0]) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");

            const formData = new FormData();
            formData.append("photo", fileInput.files[0]);

            try {
                const res = await fetch(`${API_URL}/upload-photo`, {
                    method: "POST",
                    headers: { Authorization: "Bearer " + token },
                    body: formData,
                });
                const result = await res.json();
                if (result.success) {
                    document.getElementById("profile-photo").src = API_URL + result.url;
                    alert("–§–æ—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!");
                } else {
                    alert("–û—à–∏–±–∫–∞: " + result.error);
                }
            } catch (err) {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ.");
            }
        });

        // –í—ã—Ö–æ–¥
        document.getElementById("logoutBtn").addEventListener("click", () => {
            localStorage.removeItem("token");
            window.location.href = "index.html";
        });
    });
    </script>
</body>
</html>
