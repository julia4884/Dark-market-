<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | Dark Market Ultra</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const role = localStorage.getItem("role");
  if (role !== "admin") {
    alert("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω!");
    window.location.href = "index.html"; // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
  }
});
  </script>
  <header class="site-header">
    <h1 class="site-title">‚òæ Dark Market Ultra ‚ú¶ ‚Äî üëë –ê–¥–º–∏–Ω üëë</h1>
    <nav>
      <a href="home.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="index.html">–í—ã—Ö–æ–¥</a>
    </nav>
  </header>

  <main>
    <section id="admin-panel">
      <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å üëë</h2>
      <div id="admin-info"></div>

      <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ -->
      <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞</h3>
      <form id="avatar-form">
        <input type="file" id="avatar-upload" accept="image/*" required>
        <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      </form>

      <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ -->
      <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
      <form id="file-form">
        <input type="file" id="file-upload" required>
        <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      </form>

      <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
      <h3>–í–∞—à–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</h3>
      <ul id="file-list"></ul>
      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∫–æ—à–∫–∏ –∏ –ª–µ—Ç—É—á–µ–π –º—ã—à–∏ -->
<h3>–°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ—à–∫–∏ üê± –∏ –ª–µ—Ç—É—á–µ–π –º—ã—à–∏ ü¶á</h3>
<form id="message-form">
  <select id="message-type">
    <option value="cat">–ö–æ—à–∫–∞ üê±</option>
    <option value="bat">–õ–µ—Ç—É—á–∞—è –º—ã—à—å ü¶á</option>
  </select>
  <input type="text" id="message-content" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..." required>
  <button type="submit">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
</form>

<ul id="messages-list"></ul>
    </section>
  </main>

  <!-- –õ–µ—Ç—É—á–∞—è –º—ã—à—å -->
  <div id="flying-bat">ü¶á</div>
  <div id="bat-message"></div>

  <!-- –ö–æ—à–∫–∞ -->
  <div id="cat-widget">üê±</div>
  <div id="contact-form-container" style="display:none;">
    <form id="contact-form">
      <h3>–ù–∞–ø–∏—à–∏ –∞–¥–º–∏–Ω—É</h3>
      <input type="email" id="contact-email" placeholder="–í–∞—à Email" required>
      <textarea id="contact-message" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." required></textarea>
      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button type="button" id="close-contact">–ó–∞–∫—Ä—ã—Ç—å</button>
    </form>
  </div>

  <script src="script.js"></script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const token = localStorage.getItem("token");
  const role = localStorage.getItem("role");

  if (!token || role !== "admin") {
    alert("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω! –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.");
    window.location.href = "index.html";
    return;
  }

  const messagesList = document.getElementById("messages-list");
  const messageForm = document.getElementById("message-form");

  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
  function loadMessages() {
    fetch("/admin/messages", {
      headers: { Authorization: `Bearer ${token}` },
    })
      .then((res) => res.json())
      .then((data) => {
        messagesList.innerHTML = "";
        data.forEach((msg) => {
          const li = document.createElement("li");
          li.textContent = `${msg.type === "cat" ? "üê±" : "ü¶á"} ${msg.content}`;
          messagesList.appendChild(li);
        });
      })
      .catch((err) => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:", err));
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
  messageForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const type = document.getElementById("message-type").value;
    const content = document.getElementById("message-content").value.trim();

    if (!content) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è!");

    fetch("/admin/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({ type, content }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          alert("–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!");
          document.getElementById("message-content").value = "";
          loadMessages();
        } else {
          alert("–û—à–∏–±–∫–∞: " + (data.error || "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"));
        }
      })
      .catch(() => alert("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"));
  });

  loadMessages();
});
  </script>
  <script>
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const token = localStorage.getItem("token");
  const role = localStorage.getItem("role");

  if (!token || role !== "admin") {
    alert("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω! –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.");
    window.location.href = "index.html";
  }

  // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  const adminInfo = document.getElementById("admin-info");
  adminInfo.innerHTML = `
    <p><strong>–í–∞—à Email:</strong> juliaangelss26@gmail.com üëë</p>
    <p>–£ –≤–∞—Å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
  `;

  // === –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ ===
  document.getElementById("avatar-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const avatarInput = document.getElementById("avatar-upload");
    if (!avatarInput.files.length) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫—É!");

    const formData = new FormData();
    formData.append("avatar", avatarInput.files[0]);

    try {
      const res = await fetch("/upload-avatar", {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` },
        body: formData,
      });
      const data = await res.json();
      if (data.success) {
        alert("–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω!");
        location.reload();
      } else {
        alert("–û—à–∏–±–∫–∞: " + (data.error || "–Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å"));
      }
    } catch {
      alert("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
    }
  });

  // === –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ ===
  document.getElementById("file-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const fileInput = document.getElementById("file-upload");
    if (!fileInput.files.length) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    try {
      const res = await fetch("/upload-file", {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` },
        body: formData,
      });
      const data = await res.json();
      if (data.success) {
        alert("–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω!");
        loadFiles(); // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
      } else {
        alert("–û—à–∏–±–∫–∞: " + (data.error || "–Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å"));
      }
    } catch {
      alert("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
    }
  });

  // === –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ ===
  async function loadFiles() {
    try {
      const res = await fetch("/list-files", {
        headers: { Authorization: `Bearer ${token}` },
      });
      const files = await res.json();
      const list = document.getElementById("file-list");
      list.innerHTML = files.map(f => `<li><a href="${f.url}" target="_blank">${f.name}</a></li>`).join("");
    } catch {
      console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤");
    }
  }

  loadFiles();
});
</script>
    document.addEventListener("DOMContentLoaded", () => {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–∞
      const token = localStorage.getItem("token");
      const role = localStorage.getItem("role");

      if (!token || role !== "admin") {
        alert("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω! –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.");
        window.location.href = "index.html";
      }

      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
      const adminInfo = document.getElementById("admin-info");
      adminInfo.innerHTML = `
        <p><strong>–í–∞—à Email:</strong> juliaangelss26@gmail.com üëë</p>
        <p>–£ –≤–∞—Å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
      `;

      // –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞
      document.getElementById("avatar-form").addEventListener("submit", (e) => {
        e.preventDefault();
        alert("–ê–≤–∞—Ç–∞—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω (–ø–æ–∫–∞ —Ñ–µ–π–∫-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫)!");
      });

      // –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
      document.getElementById("file-form").addEventListener("submit", (e) => {
        e.preventDefault();
        const fileInput = document.getElementById("file-upload");
        if (fileInput.files.length === 0) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!");
