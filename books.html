<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–Ω–∏–≥–∏ ‚Äî Dark Market Ultra</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: #111;
            color: #eee;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1 { margin-bottom: 20px; }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .book-card {
            background: #1c1c1c;
            padding: 15px;
            border-radius: 8px;
        }
        .book-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 6px;
        }
        .price {
            color: crimson;
            font-weight: bold;
            margin: 8px 0;
        }
        button {
            background: crimson;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            color: white;
            cursor: pointer;
        }
        button:hover { background: darkred; }
        #dev-panel {
            margin-top: 30px;
            padding: 20px;
            background: #1c1c1c;
            border-radius: 10px;
            display: none;
        }
        input {
            margin: 5px;
            padding: 8px;
            width: 80%;
            background: #222;
            color: #eee;
            border: none;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <h1>–ö–Ω–∏–≥–∏ ‚Äî Dark Market Ultra</h1>
    <nav>
        <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="home.html">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      <a href="games.html">–ò–≥—Ä—ã</a>
      <a href="movies.html">–§–∏–ª—å–º—ã</a>
      <a href="music.html">–ú—É–∑—ã–∫–∞</a>
  <a href="images.html">–ö–∞—Ä—Ç–∏–Ω–∫–∏</a>
  <a href="books.html">–ö–Ω–∏–≥–∏</a>
      <a href="apps.html">–ü—Ä–æ–≥—Ä–∞–º–º—ã</a>
      <a href="tools.html">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è</a>
    </nav>
    <p>–û–±–ª–æ–∂–∫–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã. –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ üíé</p>

    <div class="gallery" id="bookGallery">
        <!-- –°—é–¥–∞ –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è –∫–Ω–∏–≥–∏ -->
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ -->
    <section id="dev-panel">
        <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–Ω–∏–≥—É</h2>
        <input type="file" id="bookFile" accept=".pdf,.epub,.txt"><br>
        <input type="file" id="bookCover" accept="image/*"><br>
        <input type="text" id="bookTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"><br>
        <input type="number" step="0.01" id="bookPrice" placeholder="–¶–µ–Ω–∞ (‚Ç¨)"><br>
        <button id="uploadBookBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </section>

    <footer>
        <p>¬© Dark Market Ultra ¬© 2025</p>
    </footer>

    <script src="config.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("token");

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
        try {
            const res = await fetch(`${API_URL}/books/list`);
            const data = await res.json();

            const gallery = document.getElementById("bookGallery");
            gallery.innerHTML = "";

            if (data.success && data.books.length > 0) {
                data.books.forEach(book => {
                    const div = document.createElement("div");
                    div.className = "book-card";
                    div.innerHTML = `
                        <img src="${API_URL + book.cover}" alt="–û–±–ª–æ–∂–∫–∞ ${book.title}">
                        <p><b>${book.title}</b></p>
                        <p class="price">${book.price} ‚Ç¨</p>
                        <button onclick="buyBook(${book.id})">–ö—É–ø–∏—Ç—å</button>
                    `;
                    gallery.appendChild(div);
                });
            } else {
                gallery.innerHTML = "<p>–ö–Ω–∏–≥ –ø–æ–∫–∞ –Ω–µ—Ç.</p>";
            }
        } catch (err) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥", err);
        }

        // –ï—Å–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∑–∞–≥—Ä—É–∑–∫–∏
        if (token) {
            try {
                const res = await fetch(`${API_URL}/profile`, {
                    headers: { Authorization: "Bearer " + token }
                });
                const user = await res.json();
                if (user.role === "admin" || user.subscription === "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫") {
                    document.getElementById("dev-panel").style.display = "block";
                }
            } catch {}
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–π –∫–Ω–∏–≥–∏
        document.getElementById("uploadBookBtn").addEventListener("click", async () => {
            const bookFile = document.getElementById("bookFile").files[0];
            const bookCover = document.getElementById("bookCover").files[0];
            const title = document.getElementById("bookTitle").value;
            const price = document.getElementById("bookPrice").value;

            if (!bookFile || !bookCover || !price) 
                return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∫–Ω–∏–≥–∏, –æ–±–ª–æ–∂–∫—É –∏ —É–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É!");

            const formData = new FormData();
            formData.append("book", bookFile);
            formData.append("cover", bookCover);
            formData.append("title", title);
            formData.append("price", price);

            const res = await fetch(`${API_URL}/upload-book`, {
                method: "POST",
                headers: { Authorization: "Bearer " + token },
                body: formData
            });
            const result = await res.json();
            if (result.success) {
                alert("–ö–Ω–∏–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!");
                location.reload();
            } else {
                alert("–û—à–∏–±–∫–∞: " + result.error);
            }
        });
    });

    // –ó–∞–≥–ª—É—à–∫–∞ –ø–æ–∫—É–ø–∫–∏ –∫–Ω–∏–≥–∏
    async function buyBook(id) {
        const token = localStorage.getItem("token");
        if (!token) return alert("–í–æ–π–¥–∏—Ç–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏!");
        alert("–ü–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ PayPal –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –ø–æ–∑–∂–µ.");
    }

    // üö´ –ê–Ω—Ç–∏—Å–∫—Ä–∏–Ω—à–æ—Ç
    document.addEventListener("keydown", (e) => {
        if (e.key === "PrintScreen") {
            document.body.style.filter = "brightness(0%)"; 
            setTimeout(() => {
                document.body.style.filter = "brightness(100%)";
            }, 2000);
            alert("–°–∫—Ä–∏–Ω—à–æ—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã!");
        }
        if (e.ctrlKey && (e.key === "c" || e.key === "s" || e.key === "p")) {
            e.preventDefault();
            alert("–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ!");
        }
    });
    document.addEventListener("contextmenu", (e) => {
        e.preventDefault();
        alert("–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ!");
    });
    </script>
</body>
</html>
