<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–Ω–∏–≥–∏ ‚Äî Dark Market Ultra</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background:#111; color:#eee; font-family:Arial,sans-serif; text-align:center; padding:20px; }
        nav a { margin:0 10px; color:#eee; text-decoration:none; }
        nav a:hover { color:crimson; }
        .gallery { display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:20px; margin-top:20px; }
        .book-card { background:#1c1c1c; padding:15px; border-radius:8px; transition:transform .2s; }
        .book-card:hover { transform:scale(1.05); }
        .book-card img { width:100%; height:250px; object-fit:cover; border-radius:6px; }
        .price { color:crimson; font-weight:bold; margin:8px 0; }
        button { background:crimson; border:none; padding:8px 15px; border-radius:6px; color:white; cursor:pointer; }
        button:hover { background:darkred; }
        #dev-panel { margin-top:30px; padding:20px; background:#1c1c1c; border-radius:10px; display:none; }
        input { margin:5px; padding:8px; width:80%; background:#222; color:#eee; border:none; border-radius:6px; }
    </style>
</head>
<body>
<header>
    <h1>–ö–Ω–∏–≥–∏ ‚Äî Dark Market Ultra</h1>
    <nav>
        <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="home.html">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
        <a href="games.html">–ò–≥—Ä—ã</a>
        <a href="movies.html">–§–∏–ª—å–º—ã</a>
        <a href="music.html">–ú—É–∑—ã–∫–∞</a>
        <a href="images.html">–ö–∞—Ä—Ç–∏–Ω–∫–∏</a>
        <a href="books.html">–ö–Ω–∏–≥–∏</a>
        <a href="apps.html">–ü—Ä–æ–≥—Ä–∞–º–º—ã</a>
        <a href="tools.html">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è</a>
    </nav>
    <p>–û–±–ª–æ–∂–∫–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã. –ü–æ–ª–Ω—ã–µ –∫–Ω–∏–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ üíé</p>
</header>

<main>
    <div class="gallery" id="bookGallery"></div>

    <!-- –ü–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ -->
    <section id="dev-panel">
        <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–Ω–∏–≥—É</h2>
        <input type="file" id="bookFile" accept=".pdf,.epub,.txt"><br>
        <input type="file" id="bookCover" accept="image/*"><br>
        <input type="text" id="bookTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"><br>
        <input type="number" step="0.01" id="bookPrice" placeholder="–¶–µ–Ω–∞ (‚Ç¨)"><br>
        <button id="uploadBookBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </section>
</main>

<footer>
    <p>¬© Dark Market Ultra ¬© 2025</p>
</footer>

<script src="config.js"></script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
    const token = localStorage.getItem("token");
    const gallery = document.getElementById("bookGallery");

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–Ω–∏–≥–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    try {
        const res = await fetch(`${API_URL}/list-books`);
        const books = await res.json();

        gallery.innerHTML = "";
        if (books && books.length > 0) {
            books.forEach(book => {
                const div = document.createElement("div");
                div.className = "book-card";
                div.innerHTML = `
                    <img src="/books/${book.cover}" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏">
                    <p><b>${book.title}</b></p>
                    <p class="price">${book.price} ‚Ç¨</p>
                    <button onclick="buyBook('${book.title}')">–ö—É–ø–∏—Ç—å</button>
                `;
                gallery.appendChild(div);
            });
        } else {
            gallery.innerHTML = "<p>–ö–Ω–∏–≥ –ø–æ–∫–∞ –Ω–µ—Ç.</p>";
        }
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥", err);
        gallery.innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–Ω–∏–≥.</p>";
    }

    // –ü–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
    if (token) {
        try {
            const res = await fetch(`${API_URL}/profile`, {
                headers: { Authorization: "Bearer " + token }
            });
            const user = await res.json();
            if (user.role === "admin" || user.subscription === "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫") {
                document.getElementById("dev-panel").style.display = "block";
            }
        } catch {}
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–π –∫–Ω–∏–≥–∏
    document.getElementById("uploadBookBtn").addEventListener("click", async () => {
        const bookFile = document.getElementById("bookFile").files[0];
        const bookCover = document.getElementById("bookCover").files[0];
        const title = document.getElementById("bookTitle").value;
        const price = document.getElementById("bookPrice").value;

        if (!bookFile || !bookCover || !title || !price) 
            return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã!");

        const formData = new FormData();
        formData.append("book", bookFile);
        formData.append("cover", bookCover);
        formData.append("title", title);
        formData.append("price", price);

        const res = await fetch(`${API_URL}/upload-book`, {
            method: "POST",
            headers: { Authorization: "Bearer " + token },
            body: formData
        });
        const result = await res.json();
        if (result.success) {
            alert("–ö–Ω–∏–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!");
            location.reload();
        } else {
            alert("–û—à–∏–±–∫–∞: " + result.error);
        }
    });
});

// –ü–æ–∫—É–ø–∫–∞ –∫–Ω–∏–≥–∏
async function buyBook(bookName) {
    const token = localStorage.getItem("token");
    if (!token) return alert("–í–æ–π–¥–∏—Ç–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏!");
    const res = await fetch(`${API_URL}/buy-book`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token
        },
        body: JSON.stringify({ bookName })
    });
    const result = await res.json();
    if (result.success) {
        alert(result.message);
    } else {
        alert("–û—à–∏–±–∫–∞: " + result.error);
    }
}

// üö´ –ê–Ω—Ç–∏—Å–∫—Ä–∏–Ω—à–æ—Ç
document.addEventListener("keydown", (e) => {
    if (e.key === "PrintScreen") {
        document.body.style.filter = "brightness(0%)";
        setTimeout(() => { document.body.style.filter = "brightness(100%)"; }, 2000);
        alert("–°–∫—Ä–∏–Ω—à–æ—Ç—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã!");
    }
    if (e.ctrlKey && (e.key === "c" || e.key === "s" || e.key === "p")) {
        e.preventDefault();
        alert("–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ!");
    }
});
document.addEventListener("contextmenu", (e) => {
    e.preventDefault();
    alert("–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ!");
});
</script>
</body>
    </html>
