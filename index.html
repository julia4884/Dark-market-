<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dark Market Ultra</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="logo">üåå Dark Market Ultra</div>
    <nav>
      <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="games.html">–ò–≥—Ä—ã</a>
      <a href="movies.html">–§–∏–ª—å–º—ã</a>
      <a href="music.html">–ú—É–∑—ã–∫–∞</a>
      <a href="images.html">–ö–∞—Ä—Ç–∏–Ω–∫–∏</a>
      <a href="books.html">–ö–Ω–∏–≥–∏</a>
      <a href="apps.html">–ü—Ä–æ–≥—Ä–∞–º–º—ã</a>
      <a href="tools.html">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è</a>
      <a href="donate.html">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
      <a href="home.html" id="homeLink" style="display:none;">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
    </nav>
  </header>

  <main>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Dark Market Ultra</h1>
    <p>–í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º.</p>

    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
    <section id="loginSection">
      <h2>–í—Ö–æ–¥</h2>
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
        <button type="submit">–í–æ–π—Ç–∏</button>
      </form>
      <p id="loginMsg"></p>
    </section>

    <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <section id="registerSection">
      <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <form id="registerForm">
        <input type="email" id="registerEmail" placeholder="Email" required>
        <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
        <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      </form>
      <p id="registerMsg"></p>
    </section>
  </main>

  <script src="script.js"></script>
  <script>
    const backendUrl = "https://dark-market-backend.onrender.com";

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem("token");
      if (token) {
        try {
          const res = await fetch(`${backendUrl}/me`, {
            headers: { Authorization: `Bearer ${token}` }
          });
          if (res.ok) {
            document.getElementById("homeLink").style.display = "inline-block";
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("registerSection").style.display = "none";
          }
        } catch (e) {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞", e);
        }
      }
    });

    // –í—Ö–æ–¥
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value;
      const password = document.getElementById("loginPassword").value;
      try {
        const res = await fetch(`${backendUrl}/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (res.ok) {
          localStorage.setItem("token", data.token);
          window.location.reload();
        } else {
          document.getElementById("loginMsg").textContent = data.error || "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞";
        }
      } catch {
        document.getElementById("loginMsg").textContent = "–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
      }
    });

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    document.getElementById("registerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("registerEmail").value;
      const password = document.getElementById("registerPassword").value;
      try {
        const res = await fetch(`${backendUrl}/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (res.ok) {
          document.getElementById("registerMsg").textContent = "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ.";
        } else {
          document.getElementById("registerMsg").textContent = data.error || "–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏";
        }
      } catch {
        document.getElementById("registerMsg").textContent = "–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω";
      }
    });
  </script>
</body>
</html>
